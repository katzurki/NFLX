
<head>
	<script type="text/javascript">
    var fps = 24.00
    var event_counter = 0
    var new_fps = 0

    function tc2frames(timeString, framerate) {
     var timeArray = timeString.split(":")
     var hours = parseInt(timeArray[0]) * 60 * 60
     var minutes = parseInt(timeArray[1]) * 60
     var s_ms = timeArray[2].split(",")
     var seconds = parseInt(s_ms[0])
     var ms = parseInt(s_ms[1])

     var totalTime = hours + minutes + seconds + ms / 1000

     var totalFrames = Math.round(totalTime * fps)

     return totalFrames
    }

    function uid() {
     return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11)
      .replace(/[018]/g, c =>
       (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >>
        c / 4)
       .toString(16)
      )
    }

    function isInt(value){
    value = value*1
    if (value === parseInt(value, 10)) return true
    return false
    }

    function setFPS() {
     var new_fps = prompt("Current FPS set to: " + fps +
      "\nPress Enter to keep current FPS or enter new, e.g. 2500 or 2397 or 2997:","2400"
     )
     if(new_fps === null) var new_fps = 2400
     new_fps = new_fps.replace(".", "")
     new_fps = new_fps.replace(",", "")
     if (new_fps.length == 2) new_fps = new_fps + "00"
     new_fps = (new_fps.substr(0, 2) + "." + new_fps.substr(2)) * 1
     if (new_fps !== fps) {
      fps = new_fps
      alert("FPS set to: " + fps)
     }
    }

    function stylify(text) {
     var style_arr = []
     var styleobj = {}

     do {
      from = text.indexOf("<i>")
      text = text.replace("<i>", "")
      to = text.indexOf("</i>")
      text = text.replace("</i>", "")

      if (from !== -1 && to !== -1) {
       styleobj = {
        type: "italic",
        from: from,
        to: to
       }
       style_arr.push(styleobj)
      }
      styleobj = {}
     } while (text.indexOf("<i>") !== -1)
     return style_arr
    }

    function srtPrepare() {

     var allEvents = document.getElementById('srt')
      .value.split("\n\n")
     var values = []
     setFPS()

     for (event of allEvents) {

      var style_obj = {}
      var style_arr = []

      var event_lines = event.split("\n")
      if (!isInt(event_lines[0]) || !event_lines[1].includes(
        "-->")) {
        alert("Invalid event in SRT:\n0: " + event_lines[0] + "\n1: " + event_lines[1] + "\nEvent: " + event)
        throw new Error("Invalid SRT!")
       }
       var timecode = event_lines[1]
       var start = timecode.split("-->")[0].trim()
       start = tc2frames(start)
       var end = timecode.split(
        "-->")[1].trim()
       end = tc2frames(end)
       event_lines.splice(0, 2)
       var txt = event_lines.join("\n")
       var rgn = "bottom"
       if (txt.indexOf("{\\an8}") !== -1) {
        rgn = "top"
       }
       txt = txt.replace(/\{.an.\}/g, "")
       var styles = stylify(txt)
       txt = txt.replace(/<i>/g, "")
       txt = txt.replace(/<\/i>/g, "")
       var editedByUser = true
       var markup = []
       var annotations = {}
       var rubies = {}
       var validations = {}
       var knp = []
       var id = uid()
       var eventType = "TIMED_TEXT_EVENT"
       var subtitle = {
        id: id,
        start: start,
        end: end,
        txt: txt,
        eventType: eventType,
        rgn: rgn,
        styles: styles,
        editedByUser: editedByUser,
        markup: markup,
        annotations: annotations,
        rubies: rubies,
        validations: validations,
        knp: knp
       }
       values.push(subtitle)
       event_counter++
      }
      var result = {
       type: "CLIPBOARD_VALUES",
       values: values
      }
      json_events = JSON.stringify(result)
      alert("Press Enter and Ctrl+C")

      document.addEventListener('copy', function(e) {
       e.clipboardData.setData('application/json', json_events)
       e.preventDefault()
       alert("Copied " + event_counter +
        " events at FPS " + fps)
       event_counter = 0
       setTimeout(function(){ location.reload(); }, 1000);
      })

     }	</script>
</head>
<body>
	<center>
	<textarea placeholder="Paste your .SRT here" cols="50" rows="30" id="srt" name="srtSource">
</textarea><br><button onclick="srtPrepare()">Click, Then Ctrl/Cmd+C</button>
<center>
	<pre>
<b>INSTRUCTIONS:</b>

1. Your SRT file must be completely valid. No empty events. The only tags acceptable are:
<b>&lt;i&gt;&lt;/i&gt;</b> (multiple per event is OK), <b>{\an2}</b> (bottom position) <b>{\an8}</b> (top position).

2. Click the button; this will convert SRT events to Originator events, unless there is an error.

3. Press <b>Ctrl+C</b> (Windows) or <b>Cmd+C</b> (Mac) to copy the Originator events into the clipboard.

4. In the Originator there must be at least one empty event. It must be outlined in blue for the paste functionality to work.
Position your slider on the exact in-cue frame of the first event of your SRT file and press <b>Ctrl+V (Cmd+V)</b>. 
